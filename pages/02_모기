
statsmodelsimport streamlit as st
import pandas as pd
import plotly.express as px

# ---------------------------
# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# ---------------------------
@st.cache_data
def load_data():
    df = pd.read_csv("mosquito_Indicator.csv")
    df["date"] = pd.to_datetime(df["date"])
    df["year"] = df["date"].dt.year
    df["month"] = df["date"].dt.month
    return df

df = load_data()

# ---------------------------
# ì‚¬ì´ë“œë°”
# ---------------------------
st.sidebar.title("ğŸ¦Ÿ ëª¨ê¸°ì§€ìˆ˜ ëŒ€ì‹œë³´ë“œ")
st.sidebar.markdown("ë‚ ì§œ ë²”ìœ„ì™€ ì‹œê°í™” ë³€ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.")

start_date = st.sidebar.date_input("ì‹œì‘ì¼", df["date"].min())
end_date = st.sidebar.date_input("ì¢…ë£Œì¼", df["date"].max())

# ë‚ ì§œ í•„í„°ë§
mask = (df["date"] >= pd.to_datetime(start_date)) & (df["date"] <= pd.to_datetime(end_date))
filtered_df = df.loc[mask]

# ---------------------------
# ë©”ì¸ ì˜ì—­
# ---------------------------
st.title("ğŸ¦Ÿ ëª¨ê¸°ì§€ìˆ˜ & ê¸°ìƒìš”ì¸ ëŒ€ì‹œë³´ë“œ")
st.markdown("**ê¸°ê°„:** {} ~ {}".format(start_date, end_date))

# 1ï¸âƒ£ ì‹œê°„ì— ë”°ë¥¸ ëª¨ê¸°ì§€ìˆ˜ ì¶”ì´
st.subheader("ğŸ“ˆ ì‹œê°„ì— ë”°ë¥¸ ëª¨ê¸°ì§€ìˆ˜ ì¶”ì´")
fig1 = px.line(filtered_df, x="date", y="mosquito_Indicator",
               title="ëª¨ê¸°ì§€ìˆ˜ ë³€í™” ì¶”ì´",
               labels={"date": "ë‚ ì§œ", "mosquito_Indicator": "ëª¨ê¸°ì§€ìˆ˜"},
               template="plotly_white")
st.plotly_chart(fig1, use_container_width=True)

# 2ï¸âƒ£ ì˜¨ë„ë³„ ëª¨ê¸°ì§€ìˆ˜ ê´€ê³„
st.subheader("ğŸŒ¡ï¸ ì˜¨ë„ì™€ ëª¨ê¸°ì§€ìˆ˜ì˜ ê´€ê³„")
temp_var = st.selectbox("ê¸°ì˜¨ ë³€ìˆ˜ ì„ íƒ", ["mean_T(â„ƒ)", "min_T(â„ƒ)", "max_T(â„ƒ)"])
fig2 = px.scatter(filtered_df, x=temp_var, y="mosquito_Indicator",
                  trendline="ols",
                  title=f"{temp_var}ì™€ ëª¨ê¸°ì§€ìˆ˜ ê´€ê³„",
                  labels={"mosquito_Indicator": "ëª¨ê¸°ì§€ìˆ˜", temp_var: temp_var},
                  template="plotly_white")
st.plotly_chart(fig2, use_container_width=True)

# 3ï¸âƒ£ ê°•ìˆ˜ëŸ‰ê³¼ ëª¨ê¸°ì§€ìˆ˜ì˜ ê´€ê³„
st.subheader("ğŸŒ§ï¸ ê°•ìˆ˜ëŸ‰ê³¼ ëª¨ê¸°ì§€ìˆ˜ì˜ ê´€ê³„")
fig3 = px.scatter(filtered_df, x="rain(mm)", y="mosquito_Indicator",
                  size="rain(mm)", color="mean_T(â„ƒ)",
                  title="ê°•ìˆ˜ëŸ‰ê³¼ ëª¨ê¸°ì§€ìˆ˜ì˜ ê´€ê³„",
                  labels={"rain(mm)": "ê°•ìˆ˜ëŸ‰(mm)", "mosquito_Indicator": "ëª¨ê¸°ì§€ìˆ˜"},
                  template="plotly_white")
st.plotly_chart(fig3, use_container_width=True)

# 4ï¸âƒ£ ì›”ë³„ í‰ê·  ëª¨ê¸°ì§€ìˆ˜
st.subheader("ğŸ“… ì›”ë³„ í‰ê·  ëª¨ê¸°ì§€ìˆ˜")
monthly_avg = df.groupby(["year", "month"])["mosquito_Indicator"].mean().reset_index()
monthly_avg["ì—°ì›”"] = monthly_avg["year"].astype(str) + "-" + monthly_avg["month"].astype(str).str.zfill(2)

fig4 = px.bar(monthly_avg, x="ì—°ì›”", y="mosquito_Indicator",
              title="ì›”ë³„ í‰ê·  ëª¨ê¸°ì§€ìˆ˜",
              labels={"ì—°ì›”": "ì—°-ì›”", "mosquito_Indicator": "í‰ê·  ëª¨ê¸°ì§€ìˆ˜"},
              template="plotly_white")
st.plotly_chart(fig4, use_container_width=True)

# 5ï¸âƒ£ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
st.subheader("ğŸ“Š ê¸°ìƒìš”ì¸ ê°„ ìƒê´€ê´€ê³„")
corr = df[["mosquito_Indicator", "rain(mm)", "mean_T(â„ƒ)", "min_T(â„ƒ)", "max_T(â„ƒ)"]].corr()
fig5 = px.imshow(corr, text_auto=True, aspect="auto", title="ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ", template="plotly_white")
st.plotly_chart(fig5, use_container_width=True)

st.markdown("---")
st.caption("ğŸ“˜ ë°ì´í„° ì¶œì²˜: mosquito_Indicator.csv | ê°œë°œ: Streamlit + Plotly")
